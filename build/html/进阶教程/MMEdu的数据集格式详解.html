<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MMEdu的数据集格式详解 &mdash; MMEdu  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="../%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7.html" />
    <link rel="prev" title="自定义网络模块：MMBase" href="%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%EF%BC%9AMMBase.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MMEdu
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">关于MMEdu</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../%E5%85%B3%E4%BA%8EMMEdu/MMEdu%E7%9A%84%E6%95%85%E4%BA%8B.html">MMEdu的故事</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%85%B3%E4%BA%8EMMEdu/%E5%BC%80%E5%8F%91%E5%92%8C%E7%BB%B4%E6%8A%A4%E5%9B%A2%E9%98%9F.html">开发和维护团队</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%85%B3%E4%BA%8EMMEdu/%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E8%AE%B0%E5%BD%95.html">版本更新记录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%85%B3%E4%BA%8EMMEdu/MMEdu%E5%A4%A7%E4%BA%8B%E8%AE%B0.html">MMEdu大事记</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/MMEdu%E7%AE%80%E4%BB%8B.html">MMEdu简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/MMEdu%E5%AE%89%E8%A3%85.html">MMEdu安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/%E4%BD%93%E9%AA%8CMMEdu.html">体验MMEdu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/%E8%AE%AD%E7%BB%83AI%E6%A8%A1%E5%9E%8B.html">训练AI模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/%E9%83%A8%E7%BD%B2AI%E5%BA%94%E7%94%A8.html">部署AI应用</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">进阶教程</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="MMEdu%E7%9A%84%E7%9B%AE%E5%BD%95%E8%AF%A6%E8%A7%A3.html">MMEdu的目录详解</a></li>
<li class="toctree-l1"><a class="reference internal" href="MMEdu%E7%9A%84%E6%A8%A1%E5%9D%97%E6%A6%82%E8%BF%B0.html">MMEdu的模块概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%9B%BE%E7%89%87%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9D%97%EF%BC%9AClassification.html">图片分类模块：Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E7%89%A9%E4%BD%93%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9D%97%EF%BC%9ADetection.html">物体检测模块：Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%EF%BC%9AMMBase.html">自定义网络模块：MMBase</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MMEdu的数据集格式详解</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#imagenet">1.ImageNet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">第一步：整理图片</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">第二步：划分训练集、验证集和测试集</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">第三步：生成标签文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">第四步：给数据集命名</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#coco">2.COCO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">第一步、整理图片</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">第二步、标注图片</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">第三步、转换成COCO标注格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">第四步、按照目录结构整理文件</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">内置工具</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7/%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%87%E6%B3%A8%E5%B7%A5%E5%85%B7.html">数据集标注工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7/Web%E5%BA%93PyWebIO%E7%AE%80%E4%BB%8B.html">Web库PyWebIO简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7/MQTT%E5%BA%93siot%E7%AE%80%E4%BB%8B.html">MQTT库siot简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7/%E5%BC%80%E6%BA%90%E7%A1%AC%E4%BB%B6%E5%BA%93pinpong%E7%AE%80%E4%BB%8B.html">开源硬件库pinpong简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7/Web%E5%BA%93Flask%E7%AE%80%E4%BB%8B.html">Web库Flask简介</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">在线课程和创意项目</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E5%92%8C%E5%88%9B%E6%84%8F%E9%A1%B9%E7%9B%AE/%E9%A1%B9%E7%9B%AE%EF%BC%9A%E8%AE%BE%E8%AE%A1%E2%80%9C%E7%9F%B3%E5%A4%B4%E5%89%AA%E5%88%80%E5%B8%83%E2%80%9D%E9%99%AA%E7%8E%A9%E6%9C%BA%E5%99%A8%E4%BA%BA.html">项目：设计“石头剪刀布”陪玩机器人</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E5%92%8C%E5%88%9B%E6%84%8F%E9%A1%B9%E7%9B%AE/%E8%AF%BE%E7%A8%8B%EF%BC%9A%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%92%8C%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E9%AA%8C.html">课程：神经网络和计算机视觉实验</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E5%92%8C%E5%88%9B%E6%84%8F%E9%A1%B9%E7%9B%AE/%E8%AF%BE%E7%A8%8B%EF%BC%9A%E8%B5%B0%E8%BF%9B%E4%B8%87%E7%89%A9%E6%99%BA%E8%81%94%E7%9A%84%E4%B8%96%E7%95%8C.html">课程：走进万物智联的世界</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E5%92%8C%E5%88%9B%E6%84%8F%E9%A1%B9%E7%9B%AE/%E9%A1%B9%E7%9B%AE%EF%BC%9A%E7%94%B5%E8%B7%AF%E7%AC%A6%E5%8F%B7%E8%AF%86%E5%88%AB%E5%B0%8F%E5%8A%A9%E6%89%8B.html">项目：电路符号识别小助手</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">资源获取和问题解答</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96%E5%92%8C%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94.html">常见问题解答</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96%E5%92%8C%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E5%92%8C%E6%9D%83%E9%87%8D%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD.html">预训练模型和权重文件下载</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96%E5%92%8C%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%8B%E8%BD%BD.html">数据集下载</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96%E5%92%8C%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/GPU%E7%89%88%E6%9C%AC%E7%9A%84%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85.html">GPU版本的手动安装</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">深度学习知识库</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%AD%E7%BB%83%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3.html">深度学习训练参数详解</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%BB%8F%E5%85%B8%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D.html">经典数据集介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E5%BA%93/%E5%9B%BE%E7%89%87%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8BMobileNet.html">图片分类模型MobileNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E5%BA%93/%E5%9B%BE%E7%89%87%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8BLeNet-5.html">图片分类模型LeNet-5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E5%BA%93/%E5%9B%BE%E7%89%87%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8BLeNet-5.html#lenet">LeNet说明文档</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MMEdu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B.html">&lt;no title&gt;</a> &raquo;</li>
      <li>MMEdu的数据集格式详解</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/进阶教程/MMEdu的数据集格式详解.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mmedu">
<h1>MMEdu的数据集格式详解<a class="headerlink" href="#mmedu" title="Permalink to this headline"></a></h1>
<p>MMEdu系列提供了包括分类、检测等任务的若干数据集，存储在dataset文件夹下。</p>
<section id="imagenet">
<h2>1.ImageNet<a class="headerlink" href="#imagenet" title="Permalink to this headline"></a></h2>
<p>ImageNet是斯坦福大学提出的一个用于视觉对象识别软件研究的大型可视化数据库，目前大部分模型的性能基准测试都在ImageNet上完成。MMEdu的MMClassification支持的数据集类型是ImageNet，如需训练自己创建的数据集，数据集需转换成ImageNet格式。</p>
<p>ImageNet格式数据集文件夹结构如下所示，图像数据文件夹和标签文件放在同级目录下。</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>imagenet
├── ...
├── training_set
│   ├── class_0
│   │   ├── filesname_0.JPEG
│   │   ├── filesname_1.JPEG
│   │   ├── ...
│   ├── ...
│   ├── class_n
│   │   ├── filesname_0.JPEG
│   │   ├── filesname_1.JPEG
│   │   ├── ...
├── classes.txt
├── ...
</pre></div>
</div>
<p>如上所示训练数据根据图片的类别，存放至不同子目录下，子目录名称为类别名称。</p>
<p>classes.txt包含数据集类别标签信息，每行包含一个类别名称，按照字母顺序排列。</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>class_0
class_1
...
class_n
</pre></div>
</div>
<p>为了验证和测试，我们建议划分训练集、验证集和测试集，此时需另外生成“val.txt”和“test.txt”这两个标签文件，要求是每一行都包含一个文件名和其相应的真实标签。格式如下所示：</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>filesname_0.jpg 0
filesname_1.jpg 0
...
filesname_a.jpg n
filesname_b.jpg n
</pre></div>
</div>
<p>注：真实标签的值应该位于<code class="docutils literal notranslate"><span class="pre">[0,类别数目-1]</span></code>之间。</p>
<p>这里，为您提供一段用Python代码完成标签文件的程序如下所示，程序中设计了“val.txt”和“test.txt”这两个标签文件每行会包含类别名称、文件名和真实标签。</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>import os
# 列出指定目录下的所有文件名，确定类别名称
classes = os.listdir(&#39;D:\测试数据集\EX_dataset\\training_set&#39;)
# 打开指定文件，并写入类别名称
with open(&#39;D:\测试数据集\EX_dataset/classes.txt&#39;,&#39;w&#39;) as f:
    for line in classes:
        str_line = line +&#39;\n&#39;
        f.write(str_line) # 文件写入str_line，即类别名称

test_dir = &#39;D:\测试数据集\EX_dataset\\test_set/&#39; # 指定测试集文件路径
# 打开指定文件，写入标签信息
with open(&#39;D:\测试数据集\EX_dataset/test.txt&#39;,&#39;w&#39;) as f:
    for cnt in range(len(classes)):
        t_dir = test_dir + classes[cnt]  # 指定测试集某个分类的文件目录
        files = os.listdir(t_dir) # 列出当前类别的文件目录下的所有文件名
        # print(files)
        for line in files:
            str_line = classes[cnt] + &#39;/&#39; + line + &#39; &#39;+str(cnt) +&#39;\n&#39; 
            f.write(str_line) 

val_dir = &#39;D:\测试数据集\EX_dataset\\val_set/&#39;  # 指定文件路径
# 打开指定文件，写入标签信息
with open(&#39;D:\测试数据集\EX_dataset/val.txt&#39;, &#39;w&#39;) as f:
    for cnt in range(len(classes)):
        t_dir = val_dir + classes[cnt]  # 指定验证集某个分类的文件目录
        files = os.listdir(t_dir)  # 列出当前类别的文件目录下的所有文件名
        # print(files)
        for line in files:
            str_line = classes[cnt] + &#39;/&#39; + line + &#39; &#39; + str(cnt) + &#39;\n&#39;
            f.write(str_line)  # 文件写入str_line，即标注信息
</pre></div>
</div>
<p>至于如何从零开始制作一个ImageNet格式的数据集，可参考如下步骤。</p>
<section id="id1">
<h3>第一步：整理图片<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h3>
<p>您可以用任何设备拍摄图像，也可以从视频中抽取帧图像，需要注意，这些图像可以被划分为多个类别。每个类别建立一个文件夹，文件夹名称为类别名称，将图片放在其中。</p>
<p>接下来需要对图片进行尺寸、保存格式等的统一，可使用如下代码：</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>from PIL import Image
from torchvision import transforms
import os

def makeDir(folder_path):
    if not os.path.exists(folder_path):  # 判断是否存在文件夹如果不存在则创建为文件夹
        os.makedirs(folder_path)

classes = os.listdir(&#39;D:\测试数据集\自定义数据集&#39;)
read_dir = &#39;D:\测试数据集\自定义数据集/&#39; # 指定原始图片路径
new_dir = &#39;D:\测试数据集\自定义数据集new/&#39;
for cnt in range(len(classes)):
    r_dir = read_dir + classes[cnt] + &#39;/&#39;
    files = os.listdir(r_dir)
    for index,file in enumerate(files):
        img_path = r_dir + file
        img = Image.open(img_path)   # 读取图片
        resize = transforms.Resize([224, 224])
        IMG = resize(img)
        w_dir = new_dir + classes[cnt] + &#39;/&#39;
        makeDir(w_dir)
        save_path = w_dir + str(index)+&#39;.jpg&#39;
        IMG = IMG.convert(&#39;RGB&#39;)
        IMG.save(save_path)
</pre></div>
</div>
</section>
<section id="id2">
<h3>第二步：划分训练集、验证集和测试集<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h3>
<p>根据整理的数据集大小，按照一定比例拆分训练集、验证集和测试集，可使用如下代码将原始数据集按照“6:2:2”的比例拆分。</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>import os
import shutil
# 列出指定目录下的所有文件名，确定类别名称
classes = os.listdir(&#39;D:\测试数据集\自定义表情数据集&#39;)

# 定义创建目录的方法
def makeDir(folder_path):
    if not os.path.exists(folder_path):  # 判断是否存在文件夹如果不存在则创建为文件夹
        os.makedirs(folder_path)

# 指定文件目录
read_dir = &#39;D:\测试数据集\自定义表情数据集/&#39; # 指定原始图片路径
train_dir = &#39;D:\测试数据集\自制\EX_dataset\\training_set/&#39; # 指定训练集路径
test_dir = &#39;D:\测试数据集\自制\EX_dataset\\test_set/&#39; # 指定测试集路径
val_dir = &#39;D:\测试数据集\自制\EX_dataset\\val_set/&#39; # 指定验证集路径

for cnt in range(len(classes)):
    r_dir = read_dir + classes[cnt] + &#39;/&#39;  # 指定原始数据某个分类的文件目录
    files = os.listdir(r_dir)  # 列出某个分类的文件目录下的所有文件名
    files = files[:1000]
    # 按照6:2:2拆分文件名
    offset1 = int(len(files) * 0.6)
    offset2 = int(len(files) * 0.8)
    training_data = files[:offset1]
    val_data = files[offset1:offset2]
    test_data = files[offset2:]

    # 根据拆分好的文件名新建文件目录放入图片
    for index,fileName in enumerate(training_data):
        w_dir = train_dir + classes[cnt] + &#39;/&#39;  # 指定训练集某个分类的文件目录
        makeDir(w_dir)
        shutil.copy(r_dir + fileName,w_dir + classes[cnt] + str(index)+&#39;.jpg&#39;)
    for index,fileName in enumerate(val_data):
        w_dir = test_dir + classes[cnt] + &#39;/&#39;  # 指定测试集某个分类的文件目录
        makeDir(w_dir)
        shutil.copy(r_dir + fileName, w_dir + classes[cnt] + str(index) + &#39;.jpg&#39;)
    for index,fileName in enumerate(test_data):
        w_dir = val_dir + classes[cnt] + &#39;/&#39;  # 指定验证集某个分类的文件目录
        makeDir(w_dir)
        shutil.copy(r_dir + fileName, w_dir + classes[cnt] + str(index) + &#39;.jpg&#39;)
</pre></div>
</div>
</section>
<section id="id3">
<h3>第三步：生成标签文件<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h3>
<p>划分完训练集、验证集和测试集，我们需要生成“classes.txt”，“val.txt”和“test.txt”，使用上文介绍的Python代码完成标签文件的程序生成标签文件。</p>
</section>
<section id="id4">
<h3>第四步：给数据集命名<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h3>
<p>最后，我们将这些文件放在一个文件夹中，命名为数据集的名称。这样，在训练的时候，只要通过<code class="docutils literal notranslate"><span class="pre">model.load_dataset</span></code>指定数据集的路径就可以了。</p>
</section>
</section>
<section id="coco">
<h2>2.COCO<a class="headerlink" href="#coco" title="Permalink to this headline"></a></h2>
<p>COCO数据集是微软于2014年提出的一个大型的、丰富的检测、分割和字幕数据集，包含33万张图像，针对目标检测和实例分割提供了80个类别的物体的标注，一共标注了150万个物体。MMEdu的MMDetection支持的数据集类型是COCO，如需训练自己创建的数据集，数据集需转换成COCO格式。</p>
<p>MMEdu的MMDetection设计的COCO格式数据集文件夹结构如下所示，“annotations”文件夹存储标注文件，“images”文件夹存储用于训练、验证、测试的图片。</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>coco
├── annotations
│   ├── train.json
│   ├── ...
├── images
│   ├── train
│   │   ├── filesname_0.JPEG
│   │   ├── filesname_1.JPEG
│   │   ├── ...
│   ├── ...
</pre></div>
</div>
<p>如果您的文件夹结构和上方不同，则需要在“Detection_Edu.py”文件中修改<code class="docutils literal notranslate"><span class="pre">load_dataset</span></code>方法中的数据集和标签加载路径。</p>
<p>COCO数据集的标注信息存储在“annotations”文件夹中的<code class="docutils literal notranslate"><span class="pre">json</span></code>文件中，需满足COCO标注格式，基本数据结构如下所示。</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span># 全局信息
{
    &quot;images&quot;: [image],
    &quot;annotations&quot;: [annotation],
    &quot;categories&quot;: [category]
}

# 图像信息标注，每个图像一个字典
image {
    &quot;id&quot;: int,  # 图像id编号，可从0开始
    &quot;width&quot;: int, # 图像的宽
    &quot;height&quot;: int,  # 图像的高
    &quot;file_name&quot;: str, # 文件名
}

# 检测框标注，图像中所有物体及边界框的标注，每个物体一个字典
annotation {
    &quot;id&quot;: int,  # 注释id编号
    &quot;image_id&quot;: int,  # 图像id编号
    &quot;category_id&quot;: int,   # 类别id编号
    &quot;segmentation&quot;: RLE or [polygon],  # 分割具体数据，用于实例分割
    &quot;area&quot;: float,  # 目标检测的区域大小
    &quot;bbox&quot;: [x,y,width,height],  # 目标检测框的坐标详细位置信息
    &quot;iscrowd&quot;: 0 or 1,  # 目标是否被遮盖，默认为0
}

# 类别标注
categories [{
    &quot;id&quot;: int, # 类别id编号
    &quot;name&quot;: str, # 类别名称
    &quot;supercategory&quot;: str, # 类别所属的大类，如哈巴狗和狐狸犬都属于犬科这个大类
}]
</pre></div>
</div>
<p>​	这里，为您提供一种自己制作COCO格式数据集的方法。</p>
<section id="id5">
<h3>第一步、整理图片<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h3>
<p>根据需求按照自己喜欢的方式收集图片，图片中包含需要检测的信息即可，可以使用ImageNet格式数据集整理图片的方式对收集的图片进行预处理。</p>
</section>
<section id="id6">
<h3>第二步、标注图片<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h3>
<p>可使用LabelMe批量打开图片文件夹的图片，进行标注并保存为json文件。</p>
<ul class="simple">
<li><p>LabelMe：格式为LabelMe，提供了转VOC、COCO格式的脚本，可以标注矩形、圆形、线段、点。标注语义分割、实例分割数据集尤其推荐。</p></li>
<li><p>LabelMe安装与打开方式：<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">labelme</span></code>安装完成后输入<code class="docutils literal notranslate"><span class="pre">labelme</span></code>即可打开。</p></li>
</ul>
</section>
<section id="id7">
<h3>第三步、转换成COCO标注格式<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h3>
<p>将LabelMe格式的标注文件转换成COCO标注格式，可以使用如下代码：</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span>import json
import numpy as np
import glob
import PIL.Image
from shapely.geometry import Polygon

class labelme2coco(object):
    def __init__(self, labelme_json=[], save_json_path=&#39;./new.json&#39;):
        &#39;&#39;&#39;
        :param labelme_json: 所有labelme的json文件路径组成的列表
        :param save_json_path: json保存位置
        &#39;&#39;&#39;
        self.labelme_json = labelme_json
        self.save_json_path = save_json_path
        self.annotations = []
        self.images = []
        self.categories = [{&#39;supercategory&#39;: None, &#39;id&#39;: 1, &#39;name&#39;: &#39;plate&#39;}]
        self.label = []
        self.annID = 1
        self.height = 0
        self.width = 0
        self.save_json()

    # 定义读取图像标注信息的方法
    def image(self, data, num):
        image = {}
        height = data[&#39;imageHeight&#39;]
        width = data[&#39;imageWidth&#39;]
        image[&#39;height&#39;] = height
        image[&#39;width&#39;] = width
        image[&#39;id&#39;] = num + 1
        image[&#39;file_name&#39;] = data[&#39;imagePath&#39;].split(&#39;/&#39;)[-1]
        self.height = height
        self.width = width
        return image

    # 定义数据转换方法
    def data_transfer(self):
        for num, json_file in enumerate(self.labelme_json):
            with open(json_file, &#39;r&#39;) as fp:
                data = json.load(fp)  # 加载json文件
                self.images.append(self.image(data, num)) # 读取所有图片标注信息并加入images数组
                for shapes in data[&#39;shapes&#39;]:
                    label = shapes[&#39;label&#39;]
                    points = shapes[&#39;points&#39;]
                    # print(points)
                    self.annotations.append(self.annotation(points, label, num)) # 读取所有检测框标注信息并加入annotations数组
                    self.annID += 1
        print(self.annotations)

    # 定义读取检测框标注信息的方法
    def annotation(self, points, label, num):
        annotation = {}
        annotation[&#39;segmentation&#39;] = [list(np.asarray(points).flatten())]
        poly = Polygon(points)
        area_ = round(poly.area, 6)
        annotation[&#39;area&#39;] = area_
        annotation[&#39;iscrowd&#39;] = 0
        annotation[&#39;image_id&#39;] = num + 1
        annotation[&#39;bbox&#39;] = list(map(float, self.getbbox(points)))
        annotation[&#39;category_id&#39;] = self.getcatid(label)
        annotation[&#39;id&#39;] = self.annID
        return annotation

    # 定义读取检测框的类别信息的方法
    def getcatid(self, label):
        for categorie in self.categories:
            if label == categorie[&#39;name&#39;]:
                return categorie[&#39;id&#39;]
        return -1

    def getbbox(self, points):
        polygons = points
        mask = self.polygons_to_mask([self.height, self.width], polygons)
        return self.mask2box(mask)

    def mask2box(self, mask):
        &#39;&#39;&#39;从mask反算出其边框
        mask：[h,w]  0、1组成的图片
        1对应对象，只需计算1对应的行列号（左上角行列号，右下角行列号，就可以算出其边框）
        &#39;&#39;&#39;
        # np.where(mask==1)
        index = np.argwhere(mask == 1)
        rows = index[:, 0]
        clos = index[:, 1]
        # 解析左上角行列号
        left_top_r = np.min(rows)  # y
        left_top_c = np.min(clos)  # x

        # 解析右下角行列号
        right_bottom_r = np.max(rows)
        right_bottom_c = np.max(clos)

        return [left_top_c, left_top_r, right_bottom_c - left_top_c,
                right_bottom_r - left_top_r]  # [x1,y1,w,h] 对应COCO的bbox格式

    def polygons_to_mask(self, img_shape, polygons):
        mask = np.zeros(img_shape, dtype=np.uint8)
        mask = PIL.Image.fromarray(mask)
        xy = list(map(tuple, polygons))
        PIL.ImageDraw.Draw(mask).polygon(xy=xy, outline=1, fill=1)
        mask = np.array(mask, dtype=bool)
        return mask

    def data2coco(self):
        data_coco = {}
        data_coco[&#39;images&#39;] = self.images
        data_coco[&#39;categories&#39;] = self.categories
        data_coco[&#39;annotations&#39;] = self.annotations
        return data_coco

    def save_json(self):
        self.data_transfer()
        self.data_coco = self.data2coco()
        # 保存json文件
        json.dump(self.data_coco, open(self.save_json_path, &#39;w&#39;), indent=4)  # 写入指定路径的json文件，indent=4 更加美观显示

labelme_json = glob.glob(&#39;D:\测试数据集\det自定义/plate/*.json&#39;)  # 获取指定目录下的json格式的文件
labelme2coco(labelme_json, &#39;D:\测试数据集\det自定义/platecoco.json&#39;
</pre></div>
</div>
</section>
<section id="id8">
<h3>第四步、按照目录结构整理文件<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h3>
<p>创建两个文件夹“images”和“annotations”，分别用于存放图片以及标注信息。按照要求的目录结构，整理好文件夹的文件，最后将文件夹重新命名，在训练的时候，只要通过<code class="docutils literal notranslate"><span class="pre">model.load_dataset</span></code>指定数据集的路径就可以了。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%EF%BC%9AMMBase.html" class="btn btn-neutral float-left" title="自定义网络模块：MMBase" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, mmedu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>